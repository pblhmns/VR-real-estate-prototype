!function(t){function e(s){if(a[s])return a[s].exports;var o=a[s]={exports:{},id:s,loaded:!1};return t[s].call(o.exports,o,o.exports,e),o.loaded=!0,o.exports}var a={};return e.m=t,e.c=a,e.p="",e(0)}([function(t,e){if("undefined"==typeof AFRAME)throw new Error("Component attempted to register before AFRAME was available.");String.prototype.format||(String.prototype.format=function(){var t=arguments;return this.replace(/{(\d+)}/g,function(e,a){return"undefined"!=typeof t[a]?t[a]:e})}),AFRAME.registerSystem("preloader",{schema:{type:{type:"string",default:"bootstrap"},id:{type:"string",default:"preloader-modal"},autoInject:{type:"boolean",default:!0},target:{type:"selector",default:"#preloader-modal"},progressValueAttr:{type:"string",default:"aria-valuenow"},barProgressStyle:{type:"string",default:"width"},bar:{type:"selector",default:"#preloader-modal .progress-bar"},label:{type:"selector",default:"#preloader-modal .progress-label"},labelText:{type:"string",default:"{0}% Complete"},autoClose:{type:"boolean",default:!0},clickToClose:{type:"boolean",default:!1},closeLabelText:{type:"string",default:"Continue"},title:{type:"string",default:""},debug:{type:"boolean",default:!1},disableVRModeUI:{type:"boolean",default:!0},slowLoad:{type:"boolean",default:!1},doneLabelText:{type:"string",default:"Done"}},multiple:!1,loadedAssetCount:0,totalAssetCount:0,slowLoadTimeAssetUpdate:1e3,slowLoadTimePreloadFinish:4e3,init:function(){this.data.debug&&console.log("Initialized preloader"),"bootstrap"===this.data.type&&"undefined"==typeof $&&console.error("jQuery is not present, cannot instantiate Bootstrap modal for preloader!"),document.querySelector("a-assets").addEventListener("loaded",function(){this.data.debug&&console.info("All assets loaded"),this.triggerProgressComplete()}.bind(this));var t=document.querySelectorAll("a-assets a-asset-item,a-assets img,a-assets audio,a-assets video");if(this.totalAssetCount=t.length,this.watchPreloadProgress(t),!this.data.target&&this.data.autoInject)this.data.debug&&console.info("No preloader html found, auto-injecting"),this.injectHTML();else switch(this.data.type){case"bootstrap":this.initBootstrapModal($(this.data.target))}this.data.disableVRModeUI&&this.el.setAttribute("vr-mode-ui","enabled","false")},update:function(t){},watchPreloadProgress:function(t){for(var e=0;e<t.length;e++){var a;switch(t[e].nodeName){case"A-ASSET-ITEM":a="loaded";break;case"img":a="load";break;case"audio":case"video":a="loadeddata"}t[e].addEventListener(a,function(t){this.loadedAssetCount++,this.data.debug&&console.info("Loaded "+this.loadedAssetCount+"/"+this.totalAssetCount+" asset items"),this.onAssetLoaded()}.bind(this))}},onAssetLoaded:function(){if(this.loadedAssetCount===this.totalAssetCount)this.triggerProgressComplete();else{var t=Math.floor(this.loadedAssetCount/this.totalAssetCount*100);this.data.slowLoad?setTimeout(function(){this.drawProgress(t)}.bind(this),this.slowLoadTimeAssetUpdate):this.drawProgress(t)}},triggerProgressComplete:function(){this.data.slowLoad?setTimeout(function(){"bootstrap"===this.data.type&&$(this.data.bar).addClass("bg-success"),this.drawProgress(100),this.data.target.classList.add("preloader-modal__complete")}.bind(this),this.slowLoadTimePreloadFinish-1e3):("bootstrap"===this.data.type&&$(this.data.bar).addClass("bg-success"),this.drawProgress(100),this.data.target.classList.add("preloader-modal__complete")),this.data.autoClose&&!this.data.clickToClose?this.data.slowLoad?setTimeout(function(){this.triggerPreloadingComplete(),this.closeModal()}.bind(this),this.slowLoadTimePreloadFinish):(this.triggerPreloadingComplete(),this.closeModal()):this.closeBtn&&this.data.clickToClose&&(this.data.slowLoad?setTimeout(function(){this.closeBtn.setAttribute("style","display: inline-block")}.bind(this),this.slowLoadTimePreloadFinish):this.closeBtn.setAttribute("style","display: inline-block"))},drawProgress:function(t){this.data.label&&(this.data.label.innerHTML=100===t?this.data.doneLabelText:this.data.labelText.format(t)),this.data.bar&&(this.data.bar.setAttribute(this.data.progressValueAttr,t),this.data.bar.setAttribute("style",this.data.barProgressStyle+":"+t+"%"))},injectHTML:function(){switch(this.data.type){case"bootstrap":this.injectBootstrapModal()}},injectBootstrapModal:function(){if(this.data.debug&&console.info("Injecting bootstrap modal"),this.data.title)var t=$('<div id="'+this.data.id+'" class="modal instructions-modal" tabindex="-1" role="dialog"><div class="modal-dialog modal-dialog__full" role="document"><div class="modal-content"><div class="modal-header"><h4 class="modal-title">'+this.data.title+'</h4></div><div class="modal-body"><div class="col-xs-10 col-xs-offset-1 col-md-14 col-md-offset-3"><div class="progress"><div class="progress-bar progress-bar-striped progress-bar-animated active" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%"><span class="progress-label">Loading 0% Complete</span></div></div></div></div><div class="modal-footer">'+(this.data.clickToClose?'<button type="button" class="close-btn btn btn-default" data-dismiss="modal">Continue</button>':"")+"</div></div></div></div>");else var t=$('<div id="'+this.data.id+'" class="modal instructions-modal" tabindex="-1" role="dialog"><div class="modal-dialog modal-dialog__full" role="document"><div class="modal-content vertical-align text-center"><div class="col-xs-10 col-xs-offset-1 col-md-14 col-md-offset-3"><div class="progress"><div class="progress-bar progress-bar-striped progress-bar-animated active" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%"><span class="progress-label">Loading 0% Complete</span></div></div>'+(this.data.clickToClose?'<button type="button" class="close-btn btn btn-default" data-dismiss="modal">Continue</button>':"")+"</div></div></div></div>");$("body").append(t),this.data.target=t[0],this.data.label=t.find(".progress-label")[0],this.data.bar=t.find(".progress-bar")[0],this.initBootstrapModal(t)},initBootstrapModal:function(t){if(t.modal({backdrop:"static",keyboard:!1}),!this.data.title){var e=$("<style>.vertical-align {display: flex;align-items: center;}.modal-dialog__full {width: 100%;height: 100%;margin: 0;padding: 0;}.modal-dialog__full .modal-content {height: auto;min-height: 100%;border-radius: 0;}</style>");$("head").append(e)}if(this.data.clickToClose){var a=t.find("[data-dismiss=modal]");a.length>0?(this.closeBtn=a[0],this.closeBtn.setAttribute("style","display: none"),t.on("hidden.bs.modal",function(t){this.triggerPreloadingComplete()}.bind(this))):console.error('No Bootstrap modal close button is set in the HTML. Please add a button with the data-dismiss="modal" attribute to use clickToClose.')}},triggerPreloadingComplete:function(){this.data.debug&&console.info("Preloading complete"),this.data.disableVRModeUI&&this.el.setAttribute("vr-mode-ui","enabled","true"),this.el.emit("preloading-complete")},closeModal:function(){switch(this.data.type){case"bootstrap":$(this.data.target).modal("hide")}}})}]);
